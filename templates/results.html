{% extends "base.html" %}

<!-- Set the dynamic title and meta description for the results page -->
{% block title %}
    {% if branch %}
        {{ branch.ifsc }} - {{ branch.branch }}, {{ branch.bank }} | IFSC Code
    {% else %}
        IFSC Code {{ code }} Not Found | ifsclookup.in
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if branch %}
        Find complete details for IFSC code {{ branch.ifsc }}: {{ branch.branch }} branch, {{ branch.bank }}, {{ branch.address }}, {{ branch.city }}, {{ branch.state }}.
    {% else %}
        The IFSC code {{ code }} was not found. Please double-check the code and try your search again.
    {% endif %}
{% endblock %}


{% block content %}
<div class="container mx-auto max-w-4xl px-4 py-12">
    
    <!-- Breadcrumbs -->
    <nav class="text-sm text-gray-500 mb-4" aria-label="Breadcrumb">
        <ol class="list-none p-0 inline-flex flex-wrap">
            <li class="flex items-center">
                <a href="/" class="hover:text-indigo-600">Home</a>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
            {% if branch %}
            <li class="flex items-center">
                <a href="/banks" class="hover:text-indigo-600">Banks</a>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
            <li class="flex items-center">
                <a href="/bank/{{ bank_slug }}" class="hover:text-indigo-600">{{ branch.bank }}</a>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
             <li class="flex items-center">
                <a href="/bank/{{ bank_slug }}/{{ state_slug }}" class="hover:text-indigo-600">{{ branch.state }}</a>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </li>
             <li class="flex items-center">
                <a href="/bank/{{ bank_slug }}/{{ state_slug }}/{{ city_slug }}" class="hover:text-indigo-600">{{ branch.city }}</a>
            </li>
            {% endif %}
        </ol>
    </nav>

    <!-- Main Title (if branch is found) -->
    {% if branch %}
        <h1 class="text-3xl font-extrabold text-gray-900">{{ branch.bank }}</h1>
        <h2 class="text-2xl font-semibold text-gray-700 mt-1">{{ branch.branch }} Branch Details</h2>
    {% endif %}

    <!-- Results Card -->
    <div class="bg-white rounded-xl shadow-2xl overflow-hidden mt-8">
        {% if branch %}
            <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                
                <!-- Helper function to display a data row -->
                {% macro data_row(label, value, is_mono=False, copy_id=None) %}
                    <div class="py-3 border-b border-gray-100">
                        <dt class="text-sm font-medium text-gray-500">{{ label }}</dt>
                        <dd class="mt-1 text-base text-gray-900">
                            <span 
                                id="{{ copy_id | default('', true) }}" 
                                class="{% if is_mono %}font-mono font-semibold text-lg{% endif %}">
                                {{ value | default('N/A', true) }}
                            </span>
                            {% if copy_id and value %}
                            <button onclick="copyToClipboard('{{ value }}')" class="ml-2 text-xs font-medium text-indigo-600 hover:text-indigo-800">[copy]</button>
                            {% endif %}
                        </dd>
                    </div>
                {% endmacro %}

                <!-- Helper function to display a boolean service tag -->
                {% macro service_tag(label, enabled) %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                                 {% if enabled %} bg-green-100 text-green-800 {% else %} bg-gray-100 text-gray-600 {% endif %}">
                        {{ label }}
                    </span>
                {% endmacro %}

                <!-- Left Column -->
                <div>
                    {{ data_row('IFSC Code', branch.ifsc, is_mono=True, copy_id='ifsc-code') }}
                    {{ data_row('MICR Code', branch.micr, is_mono=True, copy_id='micr-code') }}
                </div>
                
                <!-- Right Column -->
                <div>
                    {{ data_row('Contact', branch.contact, is_mono=True) }}
                    {{ data_row('City', branch.city) }}
                </div>

                <!-- Full Width Address -->
                <div class="md:col-span-2">
                    {{ data_row('Address', branch.address) }}
                </div>
                
                <!-- Full Width Location -->
                <div class="md:col-span-1">
                    {{ data_row('District', branch.district) }}
                </div>
                <div class="md:col-span-1">
                    {{ data_row('State', branch.state) }}
                </div>
                
                <!-- Full Width Services -->
                <div class="md:col-span-2">
                    <dt class="text-sm font-medium text-gray-500 mb-2">Payment Services</dt>
                    <dd class="flex flex-wrap gap-2">
                        {{ service_tag('NEFT', branch.neft) }}
                        {{ service_tag('RTGS', branch.rtgs) }}
                        {{ service_tag('IMPS', branch.imps) }}
                        {{ service_tag('UPI', branch.upi) }}
                    </dd>
                </div>
            </div>
        {% elif error %}
            <div class="p-8 text-center">
                <h2 class="text-2xl font-bold text-red-600">An Error Occurred</h2>
                <p class="text-gray-600 mt-2">{{ error }}</p>
                <a href="/" class="inline-block mt-6 btn-gradient text-white font-semibold py-3 px-6 rounded-md">
                    &larr; Back to Search
                </a>
            </div>
        {% else %}
            <div class="p-8 text-center">
                <h2 class="text-2xl font-bold text-red-600">IFSC Code Not Found</h2>
                <p class="text-gray-600 mt-2">No details found for IFSC code <strong>{{ code }}</strong>. Please check the code and try again.</p>
                <a href="/" class="inline-block mt-6 btn-gradient text-white font-semibold py-3 px-6 rounded-md">
                    &larr; Back to Search
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Message box for copy-to-clipboard -->
    <div id="message-box" class="fixed bottom-4 right-4 z-50"></div>

</div>

<script>
    // Function to show a temporary "Copied!" message
    function showMessage(message) {
        const box = document.getElementById('message-box');
        const alert = document.createElement('div');
        alert.className = 'p-3 bg-green-600 text-white rounded-md shadow-lg transition-all duration-300 ease-in-out';
        alert.textContent = message;
        
        box.appendChild(alert);
        
        setTimeout(() => {
            alert.style.opacity = '0';
            setTimeout(() => {
                if (box.contains(alert)) {
                    box.removeChild(alert);
                }
            }, 300);
        }, 2000);
    }

    // Function to copy text to clipboard
    function copyToClipboard(text) {
        try {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showMessage(`Copied "${text}" to clipboard!`);
        } catch (err) {
            showMessage("Failed to copy text.");
        }
    }
</script>
{% endblock %}